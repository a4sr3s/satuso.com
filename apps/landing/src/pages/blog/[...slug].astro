---
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import { Icon } from "astro-icon/components";
import { getCollection, render } from "astro:content";
import { SITE } from "../../config/site.mjs";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => ({
    params: { slug: post.id.replace(/\.mdx?$/, "") },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);
const slug = post.id.replace(/\.mdx?$/, "");

const articleSchema = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  headline: post.data.title,
  description: post.data.description,
  datePublished: post.data.pubDate.toISOString(),
  ...(post.data.updatedDate && {
    dateModified: post.data.updatedDate.toISOString(),
  }),
  author: {
    "@type": "Organization",
    name: post.data.author,
  },
  publisher: {
    "@type": "Organization",
    name: "Satuso",
    url: SITE.url,
    logo: {
      "@type": "ImageObject",
      url: `${SITE.url}/logo.svg`,
    },
  },
  mainEntityOfPage: {
    "@type": "WebPage",
    "@id": `${SITE.url}/blog/${slug}`,
  },
};
---

<Layout
  title={`${post.data.title} | Satuso Blog`}
  description={post.data.description}
  canonicalURL={`${SITE.url}/blog/${slug}`}
  ogType="article"
>
  <Header />
  <main id="main-content" role="main" class="flex-1">
    <!-- Article header -->
    <div class="relative overflow-hidden bg-gradient-to-b from-blue-50 via-white to-white">
      <div class="absolute inset-0 overflow-hidden pointer-events-none">
        <div class="absolute -top-40 -right-40 w-80 h-80 bg-purple-200 rounded-full mix-blend-multiply filter blur-3xl opacity-20"></div>
        <div class="absolute -top-20 -left-40 w-80 h-80 bg-blue-200 rounded-full mix-blend-multiply filter blur-3xl opacity-20"></div>
      </div>
      <div class="relative max-w-3xl mx-auto px-4 pt-12 pb-8">
        <a
          href="/blog"
          class="inline-flex items-center gap-1.5 text-sm text-gray-500 hover:text-gray-900 transition-colors mb-8"
        >
          <Icon name="tabler:arrow-left" class="w-4 h-4" aria-hidden="true" />
          Back to blog
        </a>
        <header>
          <div class="flex flex-wrap items-center gap-3 mb-4">
            <time
              datetime={post.data.pubDate.toISOString()}
              class="text-sm text-gray-500"
            >
              {post.data.pubDate.toLocaleDateString("en-US", {
                year: "numeric",
                month: "long",
                day: "numeric",
              })}
            </time>
            <span class="text-gray-300">&middot;</span>
            <span class="text-sm text-gray-500">{post.data.author}</span>
          </div>
          <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-5 tracking-tight leading-tight">
            {post.data.title}
          </h1>
          {post.data.tags.length > 0 && (
            <div class="flex flex-wrap gap-2">
              {post.data.tags.map((tag: string) => (
                <span class="text-xs bg-blue-50 text-blue-600 px-3 py-1 rounded-full font-medium">
                  {tag}
                </span>
              ))}
            </div>
          )}
        </header>
      </div>
    </div>

    <!-- Article body -->
    <article class="max-w-3xl mx-auto px-4 pb-16">
      <div class="prose prose-gray max-w-none prose-headings:font-semibold prose-headings:tracking-tight prose-a:text-blue-600 prose-a:no-underline hover:prose-a:underline prose-blockquote:border-blue-200 prose-blockquote:bg-gray-50 prose-blockquote:rounded-r-lg prose-blockquote:py-1 prose-blockquote:pr-4 prose-strong:text-gray-900 prose-li:marker:text-gray-400">
        <Content />
      </div>

      <!-- CTA footer -->
      <footer class="mt-16 pt-8 border-t border-gray-200">
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl p-12 text-center text-white">
          <h3 class="text-4xl font-bold mb-4">Ready to Stop Losing Deals?</h3>
          <p class="text-xl text-blue-100 mb-8 max-w-2xl mx-auto">
            Join solopreneurs and small teams who've ditched spreadsheets for good.
          </p>
          <div class="flex flex-col sm:flex-row gap-4 justify-center">
            <a
              href={`${SITE.appUrl}/login`}
              class="inline-flex items-center justify-center gap-2 px-8 py-3 bg-white text-gray-900 rounded-lg hover:bg-gray-100 transition-colors font-medium"
            >
              <Icon name="tabler:rocket" class="w-5 h-5" aria-hidden="true" />
              Get Started
            </a>
            <a
              href="/contact-sales"
              class="inline-flex items-center justify-center gap-2 px-8 py-3 bg-transparent text-white border border-white/30 rounded-lg hover:bg-white/10 transition-colors font-medium"
            >
              <Icon name="tabler:mail" class="w-5 h-5" aria-hidden="true" />
              Contact Sales
            </a>
          </div>
        </div>
      </footer>
    </article>
  </main>
  <Footer />
  <script type="application/ld+json" set:html={JSON.stringify(articleSchema)} />
</Layout>
