---
import Layout from '../layouts/Layout.astro';
import { SITE } from '../config/site.mjs';

const web3formsAccessKey = SITE.web3formsAccessKey || "";
---

<Layout
  title="Join the Waitlist — Satuso"
  description="Be the first to know when Satuso launches. Track leads, automate follow-ups, and close more sales."
>
  <div class="min-h-screen flex">
    <!-- Left Panel - Waitlist Form -->
    <div class="flex-1 flex flex-col items-center justify-center p-8 bg-white min-h-screen">
      <div class="w-full max-w-sm">
        <!-- Logo -->
        <div class="flex justify-center mb-8">
          <a href="/">
            <img src="/logo.svg" alt="Satuso" class="h-20" />
          </a>
        </div>

        <!-- Heading -->
        <div class="text-center mb-8">
          <h1 class="text-2xl font-bold text-gray-900 mb-2">Join the Waitlist</h1>
          <p class="text-sm text-gray-500">Be the first to know when we launch. No spam, just one email when we're ready.</p>
        </div>

        <!-- Form -->
        <form id="waitlist-form" class="space-y-4" novalidate>
          {web3formsAccessKey && (
            <input type="hidden" name="access_key" value={web3formsAccessKey} />
          )}
          <input type="hidden" name="subject" value="New Waitlist Signup" />
          <input type="hidden" name="redirect" value="false" />
          <input type="checkbox" name="botcheck" class="hidden" style="display: none;" tabindex="-1" autocomplete="off" />

          <!-- Success Message -->
          <div
            id="success-message"
            class="hidden p-4 bg-green-50 border border-green-200 rounded-lg text-green-800"
            role="alert"
            aria-live="polite"
          >
            <p class="font-medium">You're on the list!</p>
            <p class="text-sm mt-1">We'll notify you when Satuso is ready.</p>
          </div>

          <!-- Error Message -->
          <div
            id="error-message"
            class="hidden p-4 bg-red-50 border border-red-200 rounded-lg text-red-800"
            role="alert"
            aria-live="assertive"
          >
            <p class="font-medium" id="error-text"></p>
          </div>

          <!-- Email Field -->
          <div>
            <label for="email" class="block text-sm font-medium text-gray-700 mb-1.5">
              Email address
            </label>
            <input
              type="email"
              id="email"
              name="email"
              placeholder="you@example.com"
              class="w-full px-3 py-2 text-sm border border-gray-200 rounded-lg focus:ring-2 focus:ring-gray-900 focus:border-transparent outline-none transition-colors"
              required
              aria-required="true"
              aria-describedby="email-error"
              autocomplete="email"
            />
            <span
              id="email-error"
              class="mt-1 text-xs text-red-600 hidden"
              role="alert"
              aria-live="polite"
            ></span>
          </div>

          <!-- Submit Button -->
          <button
            type="submit"
            id="submit-button"
            class="w-full px-4 py-2.5 bg-gray-900 text-white text-sm font-medium rounded-lg hover:bg-gray-800 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-900 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <span id="submit-text">Join Waitlist</span>
            <span id="submit-loading" class="hidden">Joining...</span>
          </button>
        </form>

        <!-- Footer link -->
        <p class="text-center text-xs text-gray-400 mt-6">
          Already have access? <a href="https://app.satuso.com/sign-in" class="text-gray-900 hover:underline">Sign in</a>
        </p>
      </div>
    </div>

    <!-- Right Panel - Marketing -->
    <div class="hidden lg:flex lg:w-1/2 bg-gray-900 text-white p-12 flex-col items-center justify-center">
      <div class="max-w-md text-center">
        <h2 class="text-4xl font-bold mb-4">Never Lose a Deal Again</h2>
        <p class="text-lg text-gray-400 mb-8">
          Track leads, automate follow-ups, and close more sales — all in one simple platform.
        </p>

        <div class="space-y-4 inline-block text-left">
          <div class="flex items-center gap-3">
            <svg class="w-5 h-5 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            <span class="text-gray-300">Visual pipeline management</span>
          </div>
          <div class="flex items-center gap-3">
            <svg class="w-5 h-5 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            <span class="text-gray-300">Automated follow-up reminders</span>
          </div>
          <div class="flex items-center gap-3">
            <svg class="w-5 h-5 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            <span class="text-gray-300">Simple contact management</span>
          </div>
          <div class="flex items-center gap-3">
            <svg class="w-5 h-5 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            <span class="text-gray-300">AI-powered deal insights</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</Layout>

<script>
  const form = document.getElementById("waitlist-form") as HTMLFormElement;
  const submitButton = document.getElementById("submit-button") as HTMLButtonElement;
  const submitText = document.getElementById("submit-text") as HTMLSpanElement;
  const submitLoading = document.getElementById("submit-loading") as HTMLSpanElement;
  const successMessage = document.getElementById("success-message") as HTMLDivElement;
  const errorMessage = document.getElementById("error-message") as HTMLDivElement;
  const errorText = document.getElementById("error-text") as HTMLParagraphElement;
  const emailInput = document.getElementById("email") as HTMLInputElement;
  const emailError = document.getElementById("email-error") as HTMLSpanElement;

  function validateEmail(email: string): boolean {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  }

  function setLoading(loading: boolean) {
    submitButton.disabled = loading;
    submitText.classList.toggle("hidden", loading);
    submitLoading.classList.toggle("hidden", !loading);
  }

  emailInput.addEventListener("blur", () => {
    const value = emailInput.value.trim();
    if (value && !validateEmail(value)) {
      emailInput.classList.add("border-red-500");
      emailError.textContent = "Please enter a valid email address";
      emailError.classList.remove("hidden");
    } else {
      emailInput.classList.remove("border-red-500");
      emailError.classList.add("hidden");
    }
  });

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    successMessage.classList.add("hidden");
    errorMessage.classList.add("hidden");

    const email = emailInput.value.trim();

    if (!email) {
      emailInput.classList.add("border-red-500");
      emailError.textContent = "Email is required";
      emailError.classList.remove("hidden");
      emailInput.focus();
      return;
    }

    if (!validateEmail(email)) {
      emailInput.classList.add("border-red-500");
      emailError.textContent = "Please enter a valid email address";
      emailError.classList.remove("hidden");
      emailInput.focus();
      return;
    }

    emailInput.classList.remove("border-red-500");
    emailError.classList.add("hidden");

    const accessKeyInput = form.querySelector('input[name="access_key"]') as HTMLInputElement;
    if (!accessKeyInput || !accessKeyInput.value.trim()) {
      // No Web3Forms key configured — store locally or show success anyway
      successMessage.classList.remove("hidden");
      form.reset();
      return;
    }

    setLoading(true);

    try {
      const formData = new FormData(form);
      const response = await fetch("https://api.web3forms.com/submit", {
        method: "POST",
        body: formData,
      });
      const data = await response.json();

      if (response.ok && data.success) {
        successMessage.classList.remove("hidden");
        form.reset();
      } else {
        errorText.textContent = data.message || "Something went wrong. Please try again.";
        errorMessage.classList.remove("hidden");
      }
    } catch {
      errorText.textContent = "Network error. Please check your connection and try again.";
      errorMessage.classList.remove("hidden");
    } finally {
      setLoading(false);
    }
  });
</script>
